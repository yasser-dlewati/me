const experienceJson = [
  {
    id: -3,
    company: "Jotun Paints",
    companyAr: "دهانات جوتن",
    position: "Sales Executive",
    positionAr: "مندوب مبيعات",
    duration: 18,
    isCurrentCompany: false,
    description: `My first job ever. A place to learn how to deal with people, how to manage time and how to be responsible.\n My main responsibility was to help the clients, introduce the products and close deals.\n`,
    descriptionAr:`كانت هذه أول وظيفة لي على الإطلاق — المكان الذي تعلمت فيه كيفية التعامل مع الناس، وإدارة الوقت، وتحمل المسؤولية.\n كانت مسؤوليتي الأساسية مساعدة العملاء، والتعريف بالمنتجات، وإتمام صفقات البيع.\n`,
    webkitURL: "https://www.jotun.com/ww-en",
    imageSrc: "jotun.jpeg",
    embededMapLink:
      "pb=!1m21!1m12!1m3!1d831.3169739645502!2d36.21109946875679!3d33.546415270793496!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m6!3e6!4m0!4m3!3m2!1d33.54617384120685!2d36.2111236086386!5e0!3m2!1sen!2smy!4v1759566409228!5m2!1sen!2smy",
  },
  {
    id: -2,
    company: "KidZone",
    position: "Mentor",
    positionAr: "مشرف برنامج المخترعون الصغار",
    duration: 24,
    isCurrentCompany: false,
    description: `As \"Little Inventors\" program mentor, I was responsible for teaching kids the basics of physics, electricity, programming and robotics using age appropriate tools and methods to make sure they understand the concepts and have fun at the same time.\n Also, I was responsible for organizing the annual events for the kids, playing roles in the plays that Kidzone hosted for the kids and their families.\n Lastly, I was responsible for documenting the experiments and working on a simple syllabus to be followed by the mentors.`,
    descriptionAr: `بصفتي مشرفًا في برنامج "المخترعون الصغار"، كنت مسؤولاً عن تعليم الأطفال أساسيات الفيزياء والكهرباء والبرمجة والروبوتات باستخدام أدوات وأساليب مناسبة لأعمارهم، لضمان الفهم والمتعة في آنٍ واحد.\n كما كنت مسؤولاً عن تنظيم الفعاليات السنوية للأطفال، والمشاركة في المسرحيات التي تستضيفها كيدزون للأطفال وعائلاتهم.\n وأخيرًا، كنت مسؤولاً عن توثيق التجارب وإعداد منهج مبسط يُتبع من قِبَل المشرفين.`,
    webkitURL: "https://www.facebook.com/KidZoneSyria/",
    imageSrc: "Kidzone.jpeg",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d318.486929755816!2d36.23401289362759!3d33.532001744626825!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1518ddd8e68c44b9%3A0x2b47005f20b74050!2sSevan%20Restaurant!5e0!3m2!1sen!2smy!4v1759566571936!5m2!1sen!2smy",
  },
  {
    id: -1,
    company: "Elaf Private School",
    companyAr: "مدرسة إيلاف الخاصة",
    position: "Educational Counselor",
    positionAr: "موجّه تربوي",
    duration: 6,
    isCurrentCompany: false,
    description:
      "I played the role of the link between the students, their families and the school. I was responsible for helping the students with resolving the diffeculties, guide them to the right path, in addition to organizing events and workshops to help the students to improve their skills.",
      descriptionAr:
      "كنت همزة الوصل بين الطلاب وأسرهم والمدرسة، ومسؤولًا عن مساعدة الطلاب في تجاوز الصعوبات، وتوجيههم نحو الطريق الصحيح، بالإضافة إلى تنظيم الفعاليات وورش العمل التي تساعدهم على تطوير مهاراتهم.",
    
    webkitURL: "http://lms.elaf-school.com/",
    imageSrc: "elaf.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3325.92347102176!2d36.21598009999999!3d33.5293753!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1518de86f19b8781%3A0x6e4db6f96f46222b!2sElaf%20Private%20School!5e0!3m2!1sen!2smy!4v1757146056675!5m2!1sen!2smy",
  },
  {
    id: 0,
    company: "Robotat",
    position: "Web developer",
    positionAr: "مطوّر ويب",
    duration: 18,
    isCurrentCompany: false,
    description:
      "First attempt to enter the software development world by getting assigned to test some feature manually (black box method) then getting enrolled in the development cycle by delivering some simple models in both front end and back end",
      descriptionAr:
      "كانت أول محاولة لدخولي عالم تطوير البرمجيات، حيث بدأت باختبار بعض الخصائص يدويًا (طريقة الصندوق الأسود)، ثم شاركت في دورة التطوير بتسليم نماذج بسيطة في الواجهة الأمامية والخلفية.",
   
    websiteUrl: "https://www.robotat.com",
    imageSrc: "robotat.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.7287107914963!2d101.6519883!3d3.166001!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87b783c5818efed7%3A0xfa5b51c991c1d246!2sPlaza%20Mont%E2%80%99%20Kiara!5e0!3m2!1sen!2smy!4v1756546255158!5m2!1sen!2smy",
  },
  {
    id: 1,
    company: "Menumiz",
    position: "Senior web developer",
    positionAr: "مطور ويب خبير",
    duration: 32,
    isCurrentCompany: false,
    description:
      "A place where I graded from a junior level to a senior. Learning a lot of the development cycle, collaporate with other departments to learn more, working hard to proof myself professionally and stepping up to be a team leader to keep the wheel rooling.",
      descriptionAr:
      "المكان الذي انتقلت فيه من مستوى مبتدئ إلى مستوى أول، وتعلمت الكثير عن دورة التطوير الكاملة، وتعاونت مع أقسام مختلفة لاكتساب معرفة أوسع. عملت بجد لإثبات نفسي مهنيًا، وتدرجت حتى أصبحت قائد فريق للحفاظ على عجلة العمل مستمرة.",
    websiteUrl: "https://www.menumiz.com",
    imageSrc: "Menumiz.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.9404660358446!2d101.66315911147416!3d3.1104541968520425!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc48f196c74b49%3A0xa754e103215446f9!2sMenumiz%20Sdn.%20Bhd.!5e0!3m2!1sen!2smy!4v1756546615873!5m2!1sen!2smy",
  },
  {
    id: 2,
    company: "Touchless",
    position: "Senior software engineer",
    positionAr: "مهندس برمجيات خبير",
    duration: 2,
    isCurrentCompany: false,
    description:
      "Being the principle software engineer is something very hard but very rewarding at the same time. During this period of time, I got the chance to meet the brightest minds and not only work with, but learn from as well.",
      descriptionAr:
      "كوني المهندس الرئيسي في الفريق كانت مسؤولية صعبة لكنها مجزية جدًا في الوقت نفسه. خلال هذه الفترة سنحت لي الفرصة للتعرف على بعض من ألمع العقول، والعمل معهم والتعلم منهم كذلك.",
    
      websiteUrl: "https://touchless.asia",
    imageSrc: "Touchless.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.7088143460246!2d101.66423242602517!3d3.171170203014705!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc485de491c479%3A0xa40997f3dc918ec8!2sSolaris%20Dutamas%2C%201%2C%20Jln%20Dutamas%201%2C%20Solaris%20Dutamas%2C%2050754%20Kuala%20Lumpur%2C%20Wilayah%20Persekutuan%20Kuala%20Lumpur!5e0!3m2!1sen!2smy!4v1756546841444!5m2!1sen!2smy",
  },
  {
    id: 3,
    company: "Boostorder",
    position: "Senior software engineer",
    positionAr: "مهندس برمجيات خبير",
    duration: 15,
    isCurrentCompany: false,
    description:
      "Being the principle software engineer is something very hard but very rewarding at the same time. During this period of time, I got the chance to meet the brightest minds and not only work with, but learn from as well.",
      descriptionAr:
      "العمل كمهندس برمجيات رئيسي كان تحديًا كبيرًا وتجربة غنية جدًا. خلال هذه المدة، التقيت وتعاونت مع نخبة من الموهوبين، وتعلمت الكثير من الخبرات العملية والفكرية.",
    websiteUrl: "https://www.boostorder.com",
    imageSrc: "boostorder.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.9086965997476!2d101.66931198601625!3d3.1188508452488763!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc49f32cabd35b%3A0x23e273f52c551332!2sBoostorder%20-%20KL%20Eco%20City!5e0!3m2!1sen!2smy!4v1756546887913!5m2!1sen!2smy",
  },
  {
    id: 4,
    company: "Monster",
    position: "Software engineer",
    positionAr: "مهندس برمجيات",
    duration: 24,
    isCurrentCompany: false,
    description:
      "First experiment working in such a big corporate which is the perfect time to engage and see how the collaporation should be done. In addition to feel proud as a working in a such a good reputation enterprises.",
      descriptionAr:
      "كانت أول تجربة لي في شركة ضخمة، أتيحت لي فيها فرصة التعرف على بيئة عمل مؤسساتية متكاملة، وكيف يتم التعاون بين الفرق بشكل احترافي. كما شعرت بالفخر لكوني جزءًا من مؤسسة ذات سمعة متميزة.",
      websiteUrl: "https://www.monster.com/about",
    imageSrc: "monster.jpeg",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.7913515491928!2d101.7089010760252!3d3.1496712531472517!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc37f6f1c8d147%3A0x8c048efb4266c0bf!2sMenara%20AIA%20Sentral!5e0!3m2!1sen!2smy!4v1756546918525!5m2!1sen!2smy",
  },
  {
    id: 5,
    company: "Timelog",
    position: "Senior software engineer I",
    positionAr: "مهندس برمجيات خبير (مستوى 1)",
    duration: 18,
    isCurrentCompany: true,
    description:
      "Woring in a team t delive a first class tier code. paricipating in mind storm sessions to detect the weakness points in the app and workin with task force team to present a solid plan to migrate to the legacy solutions to the latest technology.",
      descriptionAr:
      "أعمل ضمن فريق متميز لتقديم كود برمجي على أعلى مستوى. أشارك في جلسات العصف الذهني لتحديد نقاط الضعف في النظام، وأعمل مع فريق المهام الخاصة لوضع خطة قوية لنقل الأنظمة القديمة إلى أحدث التقنيات.",
   
    websiteUrl: "https://timelog.com/en",
    imageSrc: "timelog.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.75408995014!2d101.71612601147427!3d3.159395096802703!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc37d017eaaaab%3A0xd5c2bff92ec47876!2sINSCALE%20Malaysia!5e0!3m2!1sen!2smy!4v1756547062785!5m2!1sen!2smy",
  },
  {
    id: 6,
    company: "Carsome",
    position: "Senior software engineer II",
    positionAr: "مهندس برمجيات خبير (مستوى 2)",
    duration: 6,
    isCurrentCompany: true,
    description:
      "Working in a fast paced environment to deliver high quality code that meets the business requirements. Collaborating with cross-functional teams to design, develop, and implement new features and functionalities.",
      descriptionAr:
      "أعمل في بيئة سريعة الإيقاع لتقديم كود عالي الجودة يلبّي متطلبات العمل. أتعاون مع فرق متعددة التخصصات لتصميم وتطوير وتنفيذ ميزات ووظائف جديدة.",
   
    websiteUrl: "https://www.carsome.my",
    imageSrc: "carsome.png",
    embededMapLink:
      "pb=!1m18!1m12!1m3!1d3983.745919023914!2d101.614575!3d3.161523399999999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc4f6ce7472157%3A0x740a20f1d4ecdee!2sCARSOME%20Malaysia%20HQ!5e0!3m2!1sen!2smy!4v1761457307647!5m2!1sen!2smy",
  }
];

const userAgent = navigator.userAgent;
const regexp = /android|iphone|kindle|ipad/i;
function getLanguage() {
  return document.documentElement.lang ?? 'en'
}

export let language = {
  get value(){
    return getLanguage();
  },
  get isRTL(){
    return this.value === 'ar';
  }
}
export const isMobileDevice = regexp.test(userAgent);

export function renderClients() {
  var clients = experienceJson;
  let isShowingUnderGraduateExperience =
    document.querySelector("#showUnderGraduateExperience").checked ||
    localStorage.getItem("underGraduate") === "true";

  if (isShowingUnderGraduateExperience) {
    clients = experienceJson;
  } else {
    clients = experienceJson.filter((x) => x.id >= 0);
  }

  let clientsContainer = document.querySelector(".experience-container");
  let indicatorContent = "";
  let clientsContent = "";
  for (let i = 0; i < clients.length; i++) {
    clientsContent += `<div class='experience-item'>
      <img src="./images/${clients[i].imageSrc}" class="img-fluid bounce" alt="${clients[i].company}">
      </div>`;
    indicatorContent +=
      (!isMobileDevice && i < 3) || (isMobileDevice && i === 0)
        ? "<li class='active'></li>"
        : "<li></li>";
  }

  clientsContainer.innerHTML = clientsContent;
  document.querySelector(".experience.indicator").innerHTML = indicatorContent;
  const experienceItems = document.querySelectorAll(".experience-item img");
  experienceItems.forEach((item) => {
    item.addEventListener("click", showClientDetails);
  });
}

function showClientDetails(event) {
// Prevent the event from propagating further since the event goes to the parent
event.stopPropagation(); 
let isDarkMode =
document.body.attributes["data-theme"] &&
document.body.attributes["data-theme"].value === "dark";
{
  document
  .querySelector(".experience-details-container")
  .classList.add("active");
  document.querySelector(".experience-details-container").style.boxShadow =
  "var(--menu-box-shadow)";
  const companyName = this.alt;
  const relatedExperience = experienceJson.find(
    (x) => x.company === companyName
  );
    const html = `<div class="container">
      <div class="row">
      <div class="col-12">
      <img src="./images/${
        relatedExperience.imageSrc
      }" alt="${companyName}" class="company-logo">
      <h4 class="company-name">${language.value == 'en' ? relatedExperience.company : relatedExperience.companyAr ?? relatedExperience.company }</h4>
      <h5 class="position">${language.value == 'en' ? relatedExperience.position : relatedExperience.positionAr}</h5>
      <p class="duration">Duration: ${relatedExperience.duration} months</p>
      <p>${language.value == 'en' ? relatedExperience.description : relatedExperience.descriptionAr}</p>
      <p>Visit ${companyName} Website <a href="${
      relatedExperience.websiteUrl
    }" target="_blank" rel="noopener">here</a>!</p>
      <iframe src="https://www.google.com/maps/embed?${
        relatedExperience.embededMapLink
      }" width="100%" height="200" style=' ${
      isDarkMode ? "filter:invert(90%)" : ""
    }' allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
      </div>
      </div>`;
    document.querySelector(".experience-details").innerHTML = html;
    document.querySelectorAll('.experience-item img, .scroll-horizontally').forEach(img => {
      img.classList.remove('bounce');
      img.style.pointerEvents = 'none';
    })
    setBodyScroll(false);
    toggleCloseMenuOnOutsideClick(true);
  }
}

export function setBodyScroll(scrollable) {
  document.querySelector("body").style.overflowY = scrollable ? "" : "hidden";
  let sections = document.querySelectorAll("section");
  sections.forEach((section) => {
    section.style.filter = scrollable ? "" : "blur(8px)";
  });

  document.querySelector("ul.indicator").style.filter = scrollable ? "" : "blur(8px)";
  document.querySelector(".menu-icon").classList.toggle("disabled", !scrollable);
  document.querySelector(".menu-icon").style.filter = scrollable ? "" : "blur(8px)";
  document.querySelectorAll(".content a").forEach(a => {
    a.classList.toggle("disabled", !scrollable);
    a.style.filter = scrollable ? "" : "blur(8px)";
  })
}

function closeActiveMenuOnEscapeKey() {
  if(document.querySelector('.feedback').classList.contains('active')) {
    closeFeedbackForm();
    console.log('Clicked outside feedback form, closing it');
  }
  else if(document.querySelector('.settings-container').classList.contains('active')) {
    closeSettingsMenu();
    console.log('Clicked settings menu, closing it');
  }
  else if(document.querySelector('.navigation').classList.contains('active')) {
    closeNavigationMenu();
    console.log('Clicked navigation menu, closing it');
  }
  else if(document.querySelector('.experience-details-container').classList.contains('active')) {
   closeClientDetails();
   console.log('Clicked outside client\'s details, closing it');
  }
}

export function toggleCloseMenuOnOutsideClick(enable, additionalElements = []) {
  if(!enable) {
    document.querySelector('.content').removeEventListener('click', closeActiveMenuOnEscapeKey)
    if (additionalElements && additionalElements.length > 0) {
      additionalElements.forEach(element => {
        element.removeEventListener("click", closeActiveMenuOnEscapeKey);
      })
    }
    
    return;
  }

  document.querySelector('.content').addEventListener('click', closeActiveMenuOnEscapeKey)
  if (additionalElements && additionalElements.length > 0) {
    additionalElements.forEach(element => {
      element.addEventListener("click", closeActiveMenuOnEscapeKey);
    })
  }
}

export function closeNavigationMenu() {
  setTimeout(() => {
    setBodyScroll(true);
    $(".navigation").removeClass("active");
    $(".navigation").css("box-shadow", "none");
  }, 100);
  $(".content").css("overflow", "");
  toggleCloseMenuOnOutsideClick(false);
}

export function closeSettingsMenu() {
  $(".settings-container").removeClass("active");
      setTimeout(() => {
        $(".navigation > *").css("filter", "");
        $(".settings-container").css("box-shadow", "none");
      }, 500);
}

export function closeFeedbackForm() {
  document.querySelector(".notification").classList.remove("active");
  document.querySelector(".feedback").classList.remove("active");
  document.querySelector(".navigation").style.filter = "";
  document.querySelector(".settings-container").style.filter = "";
  let sideMenusAreActive = document.querySelector(".navigation").classList.contains("active") ||
  document
    .querySelector(".settings-container")
    .classList.contains("active") ||
  document
    .querySelector(".experience-details-container")
    .classList.contains("active");

  // Allow removing the blur effect only if no side menus are active  
  if (!sideMenusAreActive) {
    setBodyScroll(true);
    toggleCloseMenuOnOutsideClick(false);
  }
}

export function closeClientDetails() {
  document
    .querySelector(".experience-details-container")
    .classList.remove("active");
  document.querySelector(".experience-details-container").style.boxShadow =
    "none";
  document.querySelectorAll('.experience-item img, .scroll-horizontally').forEach(img => {
    img.classList.add('bounce');
    img.style.pointerEvents = 'auto';
  })
  setBodyScroll(true);
  toggleCloseMenuOnOutsideClick(false);
}

const btnCloseNotification = document.querySelector(".notification .close");
btnCloseNotification.addEventListener("click", closeNotification);

function closeNotification(){
  console.log("close notification");
  document.querySelector(".notification").classList.remove("active");
  document.querySelector(".feedback").classList.remove("active");
  setBodyScroll(true);
  toggleCloseMenuOnOutsideClick(false);
}
